{"hash":"a1d17599aa25e754da20c16ebf1fab0b16e68edd","data":{"post":{"id":"b7a1177aaf494cca80c3d081e81f4f3f","title":"How to add JavaScript to a page","tags":"javascript html performance","date":"2019-02-11T00:00:00.000Z","content":"<p>How and where you load external scripts on a page can affect page load speed and performance. <code>&#x3C;script></code> tags were usually placed in the <code>&#x3C;head></code> section and quite often without only the <code>src</code> attributes. These external Scripts are loaded and executed synchronously, meaning the HTML parser is forced to wait for the resource to be fetched.\nIf there is an issue with the server response, this could result in page blocking and a terrible user experience. In order to avoid this, it is recommended to defer javascript loading and execution until the page is rendered.</p>\n<p>One common solution is to place the <code>&#x3C;script></code> tag at the end of the <code>&#x3C;body></code> tag to ensure that the DOM is loaded first before executing any javascript. However, there are other equally good solutions.</p>\n<h2 id=\"aysnc-and-defer-attributes\"><a href=\"#aysnc-and-defer-attributes\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>aysnc and defer attributes</h2>\n<p>The <code>&#x3C;script></code> tags are placed in the <code>&#x3C;head></code> section with attributes <code>async</code> or <code>defer</code>. These attributes tell the browser how to fetch and execute external scripts.</p>\n<p>The <code>defer</code> attribute tells the browser to load the script but not execute any Javascript until the DOM is ready (the document has been fully parsed and before the <code>DOMContentLoaded</code> event is fired).</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">defer</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The <code>async</code> attribute tells the browser to execute the external script asynchronously. The HTML parser can continue parsing the page without\nwaiting for the script to be executed.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">async</span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p><small>Check <a href=\"https://caniuse.com\" rel=\"noopenner noreferrer\" target=\"_blank\">caniuse.com</a> for browser compatibility of <a href=\"https://caniuse.com/#search=async\" rel=\"noopenner noreferrer\" target=\"_blank\">async</a> and <a href=\"https://caniuse.com/#search=defer\" rel=\"noopenner noreferrer\" target=\"_blank\">defer</a> attributes.</small></p>\n<h2 id=\"dynamic-insert\"><a href=\"#dynamic-insert\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Dynamic insert</h2>\n<p>There are some cases where you only want to load a script in certain situations. This is known as <strong>on-demand loading</strong> to avoid unnecessary requests.</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">insertScript</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id<span class=\"token punctuation\">,</span> callback</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">var</span> scriptInDoc <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">getElementsByTagName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> script <span class=\"token operator\">=</span> <span class=\"token dom variable\">document</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">createElement</span><span class=\"token punctuation\">(</span><span class=\"token string\">'script'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token property-access\">src</span> <span class=\"token operator\">=</span> <span class=\"token string\">'https://....'</span><span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token property-access\">id</span> <span class=\"token operator\">=</span> id<span class=\"token punctuation\">;</span>\n  script<span class=\"token punctuation\">.</span><span class=\"token method-variable function-variable method function property-access\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  scriptInDoc<span class=\"token punctuation\">.</span><span class=\"token property-access\">parentNode</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">insertBefore</span><span class=\"token punctuation\">(</span>script<span class=\"token punctuation\">,</span> scriptInDoc<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"icon icon-link\"></span></a>Conclusion</h2>\n<p>Always incorporate JavaScript asynchronously and only load external scripts at the point when they are needed to avoid extra network requests.</p>\n","timeToRead":2}},"context":{}}